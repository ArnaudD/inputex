<html>
<head>
<title>Rdf</title>


<!-- InputEx CSS -->
<link type='text/css' rel='stylesheet' href='../css/inputEx.css' />

<!-- YUI Library -->
<script type="text/javascript" src="../lib/yui/yahoo/yahoo-min.js"></script> 
<script type="text/javascript" src="../lib/yui/dom/dom-min.js"></script> 
<script type="text/javascript" src="../lib/yui/event/event-min.js"></script>


<!-- InputEx -->
<script src="../build/inputex-min.js"  type='text/javascript'></script>

<script src="parser.js"></script>
<script>

YAHOO.inputEx.RdfBuilder = {
	
	foafNS: "http://xmlns.com/foaf/0.1/",
	inputexNS: "http://javascript.neyric.com/inputex/",
	rdfNS: "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
	
	build: function(rdfFile, lensFile, parentEl) {
		this._tempParentEl = parentEl;
		this._tempLensFile = lensFile;
		
		// Get the RDF source file
		this.rdf = new RDF();
		var that=this;
		this.rdf.getRDFURL(rdfFile, function() { that.fileCallback(); });
	},
	
	fileCallback: function() {
		var that = this;
		// Get the Lens RDF file
		this.rdf.getRDFURL(this._tempLensFile, function () { that.lensCallback(); });
	},
	
	lensCallback: function() {
		
		   console.log( this.rdf.toNTriples()  );
			
			 
		   var group = { fields: [] };

		   // Find all defined groups in the lens
		   var groups = this.rdf.Match(null, null, this.rdfNS+"type", this.inputexNS+"Group");

		  // on fait le premier pour l'instant:
		  var type0 = groups[0].subject.split('#')[1];
		  var objects = this.rdf.Match(null, null, this.rdfNS+"type", type0);

		  // on fait l'objet 0 pour l'instant
		  var objectSubject = objects[0].subject;
		  var properties = this.rdf.Match(null,objectSubject, null, null);

		  // Faire le mic-mac entre fields et properties
		  for(var i = 0 ; i < properties.length ; i++) {
		     var propertyName = properties[i].predicate;
		     var fittingField = this.rdf.Match(null, groups[0].subject, null, propertyName);
		     if( fittingField.length > 0) {
					var temp = fittingField[0].predicate.split('/'); // temp predicate string to extract inputEx type

					var field = { 
						type: temp[temp.length-1], 
						inputParams: {
							value: properties[i].object, 
							visu: {
								visuType: 'func', 
								func: function(value){ return YAHOO.inputEx.cn('img',{src:value},{border: '2px solid black'}); } 
							} 
						}
					};
					
					group.fields.push(field);
		     }
		  }
			
			// Build the form
			var d = YAHOO.util.Dom.get('formContainer');
			group.parentEl = d;
			d.innerHTML = "";
			new YAHOO.inputEx.Group(group);
	}
	
};

YAHOO.util.Event.addListener(window, "load", function() {
	YAHOO.inputEx.RdfBuilder.build("proxy.php?url=http://www.mybloglog.com/buzz/members/neyric/foaf/", 
													 'foaf-lens.rdf');
	
});


</script>
</head>
<body>

<div style="margin: 40px; padding: 20px; background-color: #ccccff;">
	
	<p style="font-size: 14pt; font-weight: bold;">inputExRdf</p>
	
	<p>Generated from this <a href="http://www.mybloglog.com/buzz/members/neyric/foaf/">RDF file</a> and this <a href="foaf-lens.rdf">lens</a>.</p>
	
	<center>
	<div id='formContainer' style="width: 400px; background-color: white; padding: 20px;">
		<center>
			<img src='../images/spinner.gif'> <br />
			<b>Loading RDF files...</b>
		</center>
	</div>
	</center>
</div>

</body>
</html>
