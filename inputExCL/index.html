<!--
TODO:
	- avoir un autocompleter action

	- Pour chaque action, on définit un formulaire de paramètres

	- Pour chaque action, on définit une fonction qui prend la valeur du formulaire en entrée

	- s'inspirer des modules de http://code.google.com/p/tphp/
	
	-->
<html>
<head>
<title>inputEx Command Line</title>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
	
<!-- YUI CSS -->
<link rel="stylesheet" type="text/css" href="../lib/yui/reset-fonts/reset-fonts.css">
<link rel="stylesheet" type="text/css" href="../lib/yui/container/assets/container.css"> 
<link rel="stylesheet" type="text/css" href="../lib/yui/assets/skins/sam/skin.css">

<!-- InputEx CSS -->
<link type='text/css' rel='stylesheet' href='../css/inputEx.css' />

<style>

#CL-container {
	background-color: #50465C;
	height: 400px;
	width: 400px;
	margin: 60px auto;
}

#CL-container a {
	margin: 5px;
	color: #ccccff;
	text-decoration: none;
	font-size: 13pt;
}

#CL-box {
	width: 300px;
	height: 300px;
	background-color: #5D5468;
	margin: 30px;
	padding: 10px;
}

</style>

</head>
<body class="yui-skin-sam">
	
	<p style="text-align: center; font-size: 18pt; font-weight: bold; margin: 10px;">inputEx Command Line</p>
	
<div id='CL-container'>
	
	<a href="">Clear</a>
	<a href="" id='runLink'>Run</a>
	
	<div id="CL-box">
	</div>
	
</div>


<!-- YUI Library -->
<script type="text/javascript" src="../lib/yui/utilities/utilities.js"></script>
<script type="text/javascript" src="../lib/yui/container/container-min.js"></script>
<script type="text/javascript" src="../lib/yui/json/json-min.js"></script>

<!-- InputEx -->
<script src="../build/inputex-min.js"  type='text/javascript'></script>

<script>


// Required for the tooltips
inputEx.spacerUrl = "../images/space.gif";


inputEx.CL = {
   
   /**
    * Entry point
    */
   init: function() {
      
      // Create the container
      this.el = YAHOO.util.Dom.get('CL-box');
      
      this.renderAutocompleter();
      
      this.formContainer = inputEx.cn('div');
      this.el.appendChild(this.formContainer);
      
      YAHOO.util.Event.addListener('runLink', 'click', this.onRun, this, true);
   },
   
   onRun: function(e) {
      YAHOO.util.Event.stopEvent(e);
      if(!this.group) {return;}
      if(!this.activeModule) {return;}
      this.activeModule.run( this.group.getValue() );
   },
   
   renderAutocompleter: function() {
      var that = this;
   	// Autocompleter :
   	new inputEx.AutoComplete({
   	   parentEl: this.el,
         queryMinLength: 1,
         displayEl: function(val) {
   			 return inputEx.cn('div', null, null, YAHOO.lang.substitute("<b>{name}</b> <i><u>{command}</u></i> {description}", val));
   		},
   		query: function(val) {
   		   var modules = [];
   		   for(var cmd in inputEx.CL.modules) {
   		      if( cmd.substr(0,val.length) == val ) {
   		         modules.push(inputEx.CL.modules[cmd]);
   		      }
   		   }
   		   this.updateList(modules);
   		},
   		displayAutocompleted: function(val) {
   		   //if( that.nBoxes < 2) { that.addBox(); }
   		   
   		   that.activeModule = val;
   		   if(!val.parameterGroup) {
   		      window.open(val.link);
   		   }
   		   else {
   		      var boxEl = that.formContainer;
   		      boxEl.innerHTML = "";
   		      that.group = new inputEx.Group(val.parameterGroup);
   		      boxEl.appendChild(that.group.getEl());
		      }
   		   
   			return YAHOO.lang.substitute("{command}", val);
   		}
   	});

      
   }
   
};

YAHOO.util.Event.addListener(window, "load", inputEx.CL.init, inputEx.CL, true);



inputEx.CL.modules = {

   map: {
      name: 'Map Search',
      command: 'map',
      description: 'Search with Google Maps',
      parameterGroup: {
         fields: [
				{label: 'Adress', type: 'text', inputParams: {name: 'adress', value:'33 rue de la breche aux loups\n 75012 Paris France' } }
			]
      },
      run: function(val) {
         window.open('http://maps.google.com/?q='+val.adress);
      }
   },

   mail: {
      name: 'Mail',
      command: 'mail',
      description: 'Open Gmail',
      link: 'http://www.gmail.com'
   },

   reader: {
      name: 'Google Reader',
      command: 'reader',
      description: 'Open Google Reader',
      link: 'http://www.google.com/reader'
   },

   ping: {
      name: 'Ping',
      command: 'ping',
      description: 'Ping a hostname or IP',
      parameterGroup: {
         fields: [
				{type:'ipv4', label: 'IP', inputParams: {name: 'ip', value:'138.195.153.30' } }
			]
      },
      run: function(val) {
         alert(val.firstname);
         window.open('http://www.google.com');
      }
   },
   
   wp: {
      name: 'Wikipedia',
      command: 'wp',
      description: 'Perform a wikipedia search',
      parameterGroup: {
         fields: [
				{label: 'Wikipedia search', inputParams: {name: 'search', required: true, value:'' } }
			]
      },
      run: function(val) {
         window.open('http://en.wikipedia.org/wiki/'+val.search);
      }
   }

};

</script>
</body>
</html>

